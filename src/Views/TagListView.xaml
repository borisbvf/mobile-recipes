<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Recipes.Views.TagListView"
             xmlns:models="clr-namespace:Recipes.Models"
			 xmlns:viewmodels="clr-namespace:Recipes.ViewModels"
			 x:DataType="viewmodels:TagListViewModel"
			 x:Name="TagListPage"
			 Title="{Binding Title, Mode=OneWay}">
	<ContentPage.Resources>
		<viewmodels:TextToColorConverter x:Key="textToColor"/>
	</ContentPage.Resources>
	<Shell.BackButtonBehavior>
		<BackButtonBehavior
			Command="{Binding SaveCheckedCommand}"/>
	</Shell.BackButtonBehavior>
	<ContentPage.ToolbarItems>
		<ToolbarItem
			Order="Primary"
			IconImageSource="{AppThemeBinding Light=add_light.png, Dark=add_dark.png}"
			Text="{Binding LocalizationManager[Add]}"
			Command="{Binding AddTagCommand}"/>
	</ContentPage.ToolbarItems>
	<RefreshView
		IsRefreshing="{Binding IsRefreshing, Mode=TwoWay}"
		Command="{Binding GetTagsCommand}">
		<CollectionView
			EmptyView="{Binding LocalizationManager[TagsEmptyCaption]}"
			SelectionMode="None"
			ItemsSource="{Binding Tags}">
			<CollectionView.ItemTemplate>
				<DataTemplate x:DataType="models:ObservableTag">
					<Border
						BackgroundColor="{Binding BackgroundDragColor}"
						StrokeShape="RoundRectangle 5"
						Margin="2"
						Padding="2">
						<Border.GestureRecognizers>
							<TapGestureRecognizer
								Command="{Binding BindingContext.TapTagCommand, Source={x:Reference TagListPage}}"
								CommandParameter="{Binding}"/>
							<DragGestureRecognizer
								DragStartingCommand="{Binding BindingContext.DragTagStartingCommand, Source={x:Reference TagListPage}}"
								DragStartingCommandParameter="{Binding}"
								CanDrag="True"/>
							<DropGestureRecognizer
								DragOverCommand="{Binding BindingContext.DragTagOverCommand, Source={x:Reference TagListPage}}"
								DragOverCommandParameter="{Binding}"
								DragLeaveCommand="{Binding BindingContext.DragTagLeaveCommand, Source={x:Reference TagListPage}}"
								DragLeaveCommandParameter="{Binding}"
								DropCommand="{Binding BindingContext.DropTagCommand, Source={x:Reference TagListPage}}"
								DropCommandParameter="{Binding}"
								AllowDrop="True"/>
						</Border.GestureRecognizers>
						<Grid
							BackgroundColor="{Binding BackgroundSelectColor}"
							RowDefinitions="40"
							Padding="2"
							Margin="1">
							<Frame
								HorizontalOptions="Start"
								Padding="5"
								CornerRadius="15"
								BackgroundColor="{Binding Path=Color, Converter={StaticResource textToColor}}">
								<Frame.GestureRecognizers>
									<DragGestureRecognizer
										DragStartingCommand="{Binding BindingContext.DragTagStartingCommand, Source={x:Reference TagListPage}}"
										DragStartingCommandParameter="{Binding}"
										CanDrag="True"/>
								</Frame.GestureRecognizers>
								<Label
									Margin="5"
									Text="{Binding Name}"
									TextColor="{StaticResource Gray600}"
									FontAttributes="Bold"
									FontSize="14"/>
							</Frame>

							<HorizontalStackLayout
								HorizontalOptions="End">
								<ImageButton
									WidthRequest="36"
									Command="{Binding BindingContext.EditTagCommand, Source={x:Reference TagListPage}}"
									CommandParameter="{Binding}"
									Source="{AppThemeBinding Light=edit_light.png, Dark=edit_dark.png}"/>
								<ImageButton
									WidthRequest="36"
									Command="{Binding BindingContext.SelectColorCommand, Source={x:Reference TagListPage}}"
									CommandParameter="{Binding}"
									Source="{AppThemeBinding Light=palette_light.png, Dark=palette_dark.png}"/>
								<ImageButton
									WidthRequest="36"
									Command="{Binding BindingContext.DeleteTagCommand, Source={x:Reference TagListPage}}"
									CommandParameter="{Binding}"
									Source="{AppThemeBinding Light=delete_light.png, Dark=delete_dark.png}"/>
							</HorizontalStackLayout>
						</Grid>
					</Border>
				</DataTemplate>
			</CollectionView.ItemTemplate>
		</CollectionView>
	</RefreshView>
</ContentPage>